
# 性能分析()——观测工具 #

性能观测工具可以按照系统级别和进程级别来分类。多数的工具要么基于计数器要么基于跟踪，还有一些性能工具本身是基于计数器或者跟踪工具的，比如剖析（profiling，对系统或进程进行一系列快照，以此进行观测）和监视工具。

## 1. 计数器 ##

内核维护了各种统计数据，称为计数器，用于对事件计数。通常计数器实现为无符号的整型数，发生事件时递增。计数器的使用可以认为是“零开销”的，因为他们默认就是开启的，而且始终由内核维护。唯一的使用开销是从用户空间读取它们的时候，但这个开销基本可以忽略不计。

系统级别：（下面这些工具利用内核的计数器在系统软硬件的环境中检查系统级别的活动。

* vmstat：虚拟内存和物理内存的统计，系统级别。
* mpstat：每个CPU的使用情况
* iostat：每个磁盘IO的使用情况，由块设备接口报告
* netstat：网络接口的统计，TCP/IP栈的统计，以及每个连接的一些统计信息
* sar：各种各样的统计，能归档历史数据。

进程级别：（以进程为导向，使用内核为每个进程维护的计算器。一般来说，下面这些工具是从proc文件系统里读取统计信息的。）

* ps：进程状态，显示进程的各种统计信息，包括内存和CPU的使用
* top：按一个统计数据(如CPU使用)排序，显示排名高的进程。基于 Solaris的系统对应的工具是 prstat(1M)
* pmap：将进程的内存段和使用统计一起列出。

## 2. 跟踪 ##

跟踪收集每一个事件的数据以供分析。跟踪框架一般默认是不启用的，因为跟踪捕获数据会有CPU开销，另外还需要不小的存储空间来存放数据。这些开销会拖慢所跟踪的对象，在解释测量时间的时候需要加以考虑。

日志，包括系统日志，可以认为是一种默认开启的低频率跟踪。日志包括每一个事件的数据，虽然通常只针对偶发事件，如错误和警告。

系统级别：利用内核的跟踪设施，下面的跟踪工具在系统软硬件的环境中检查系统级别的活动。

* tcpdump：网络包跟踪，使用libpcap库。
* snoop：为基于 Solaris的系统打造的网络包跟踪工具。
* blktrace：块IO跟踪（Linux）
* iosnoop：块O跟踪(基于 DTrace)。
* execsnoop：跟踪新进程(基于 DTrace)。
* dtruss：系统级别的系统调用缓冲跟踪(基于 DTrace)。
* DTrace：跟踪内核的内部活动和所有资源的使用情况(不仅仅是网络和块IO) 
* SystemTap：跟踪内核的内部活动和所有资源的使用情况，支持静态和动态的跟踪。
* perf：Linux性能事件，跟踪静态和动态的探针。

进程级别：以进程为导向的，基于的是操作系统提供的框架

strace：基于 Linux系统的系统调用跟踪。
truss：基于 Solaris系统的系统调用跟踪。
gdb：源代码级别的调试器，广泛应用于 Linux系统。
mdb： Solaris系统的一个具有可扩展性的调试器。
调试器能够检查每一个事件的数据，不过做这件事情时需要停止目标程序的执行，然后再启动。
诸如 DTrace、 SystemTap和perf这样的工具，虽然更适合归纳到系统级别一类中，但是它们都支持对单个进程做检查。
4.1

进程级别：

## 3. 剖析 ##

## 4. 监视 ##

time命令属于什么观测工具呢？