
## 1. 中断的概念 ##

注意，提到中断，需要参考上下文分析其具体含义。

**中断**通常是指硬件产生的异步中断。

**广义上的中断**则包括中断和异常，是强制性的执行流的转移，从当前正在执行的程序或任务转移到一个特殊的例程或任务。当处理器收到中断信号或检测到异常时，便挂起当前正在运行的进程或者任务，而转去执行中断或异常处理例程。中断或异常处理例程执行完毕之后，处理器继续执行被中断的进程或任务。

* 中断：又称为异步中断，外部中断。是其他硬件依照CPU时钟信号随机产生的。中断又被分为可屏蔽硬件中断和不可屏蔽中断。
* 异常：又称为同步中断，内部中断。是当指令执行时CPU控制单元产生的，之所以称为同步，是因为只有在一条指令终止执行后CPU才会发出中断。在不失进程执行连续性的同时，按引起的异常的指令是否能重新执行,且依据它们被报告的方式，异常分为错误，陷阱，和终止三种情况。

1. 错误：错误是一种通常可以能够被修正的异常，一旦修正，程序能够不失去连续性地接着执行。当报告错误发生时，处理器将机器状态恢复到执行错误之前的状态。错误处理例程的返回地址指向产生错误的指令，而不是错误指令之后的的那条指令。如页错误。
2. 陷阱：当引起陷阱的指令发生时，马上产生该异常。陷阱允许程序不失去连续性的继续执行。陷阱处理例程的返回地址指向引起陷阱的指令的下一条指令（与错误本质上的区别）。如溢出。
3. 终止：它并不总是报告产生异常的指令的确定位置，也不允许引起终止的进程或任务重新执行。如总线错误导致异常终止。

> 提供外部中断主要是为了提高CPU的处理效率，因为大多数外设比处理器慢得多，有了中断，处理器就可以在IO操作进行的时候执行其他指令。

## 2. 中断周期 ##

为适应中断，将中断周期加入到指令周期中。在中断周期中，处理器检查是否发生了中断，这将由中断请求信号的出现来指示。如果没有中断请求，则处理器继续进入取指周期，读取当前程序的下一条指令。如果出现中断请求，则处理器执行如下操作：

1. 挂起当前正在执行的程序，并保存状态（程序计数器PC的当前内容，及其他任何与处理器当前活动关联的数据）
2. 将PC设置为中断处理例程的起始地址

中断处理例程一般是操作系统所属的部分。中断处理例程结束后，处理器能够在断点处回复用户程序的执行。

中断向量：Intel x86共支持256中向量中断，Intel给每种中断源编号，从0-255,并把这个无符号整数叫做一个中断向量。不可屏蔽中断的向量和异常的向量是固定的，而可屏蔽的硬件中断可以通过对中断控制器编程来改变。

中断描述符表：中断描述符表（Interrupt Descriptor Table，IDT）是一个系统表，它与每一个中断或异常向量相关，每一个向量在表中有相应的中断或异常处理程序的入口地址。内核在允许中断发生前，必须适当地初始化IDT，用lidt汇编指令初始化idtr。

> 任务门：当中断信号发生时，必须取代当前进程的那个进程的TSS选择符存放在任务门中。
> 中断门：包含段选择符和中断或异常处理程序的段内偏移量。当控制权转移到一个适当的段时，处理器清IF标志，从而关闭将来会发生的可屏蔽中断。
> 陷阱门：与中断门相似，只是控制权传递到一个适当的段时处理器不修改IF标志。Linux利用中断门处理中断，利用陷阱门处理异常。

## 多重中断 ##

当中断时发生中断时有两种处理方式。一是在中断处理过程中禁止其他中断，此时其他中断会保持在“未决状态”，在处理器允许中断后就会检测到这种未决状态。这种方式的缺点在于不能考虑相对优先级和时间的紧迫性。第而终方式是定义中断的优先级，且允许高优先级中断引起低级中断处理例程本身被中断。

## 参考 ##

中断，异常，陷阱，软硬中断，同异步中断？？ - 番茄味的可比克的回答 - 知乎
https://www.zhihu.com/question/30432536/answer/54998416