# OS笔记(9)——文件系统 #

文件是对IO的抽象。程序在进行输入输出时，是以文件为单位的。

* 文件系统（file system）：操作系统中处理文件的部分称为文件系统。

## 1. 文件 ##

文件命名规则在各个OS中不尽相同。需要注意的一点是，Unix-like文件系统是区分大小写的，MS-DOS则是不区分大小写的。

文件可以有多种构造方式，常见的一种文件结构实现是采用无结构的字节序列，OS实际上不知道也不关心文件的内容是什么，OS所见到的就是字节，其任何含义只在用户程序中解释。在Unix和Windows中都采用这种方法。

很多OS支持多种文件类型，如普通文件、目录文件等。普通文件包含有用户信息（一般分为ASCII和二进制文件），目录则是管理文件系统结构的系统文件。

大多数OS使用目录树来组织文件系统，此时需要某种方法指明文件。常用的方法有两种。

* 绝对路径：从根目录到文件的路径组成。
* 相对路径：相对于当前进程工作目录的一个路径。

## 2. 文件系统的实现 ##

**1.文件系统布局**

文件系统存放在磁盘上。多数磁盘划分为一个或多个分区，每个分区中有一个独立的文件系统。

![文件系统布局](http://sweeat.me/fs-layout.png)

* 主引导记录(Master Boot Record, MBR)：位于磁盘的0号扇区，由BIOS读入并执行；作用是确定活动分区，读入并执行其引导块，引导块中的程序装载该分区的操作系统。
* 分区表：位于MBR结尾，其作用是给出每个分区的起始和结束地址。
* 引导块：每个分区都是从一个引导块开始，即使它不含有一个可启动的操作系统。

除了从引导块开始之外，磁盘分区的布局是随着文件系统的不同而变化。文件系统经常包含有如下项目：

* 超级块：包含文件系统的所有关键参数，在计算机启动或该文件系统首次使用时，把超级块读入内存。超级块的典型信息包括：确定文件系统类型用的魔数、文件系统中的数据块的数量以及其他重要的管理信息。
* 空闲空间管理：管理空闲块信息，例如可以用位图或者链表的形式记录。
* i节点：一个数据结构数据，每个文件一个，i节点说明了文件的方方面面。后面会重点谈到。
* 根目录：存放文件系统目录树的根部。
* 文件和目录：就是存放其他所有的目录和文件。

**2.文件存储实现**

前面说过，文件对于大多数操作系统来说就是一个字节序列，这是其逻辑上的结构。对于文件的存储实现，有以下几种。

* 连续分配：最简单的分配方案是把每个文件作为一连串连续数据块存储到磁盘上。
