# OS笔记(2)——进程与线程 #


**进程是cpu资源分配的最小单位，线程是cpu调度的最小单位。**

## 5. 协程：用户级线程 ##

通常说的多线程指内核级多线程，操作系统对线程是有感知的，内核中会维护线程表。内核级线程特点如下：

* 内核级线程切换，需要在用户态和内核态之间切换，开销比较大。
* （如上节所说，）内核级线程能够充分利用多处理机的并行能力。

在操作系统不支持线程的情况下，可以在用户空间自行实现线程，此时内核对于用户级线程（协程）是没有感知的，每个进程需要自己维护自己的线程表记录线程信息，并自行实现调度机制。用户级线程特点如下：

* 允许进程有自己定制的调度算法。
* 本地阻塞时，用户级线程切换，不需要在用户态和内核态之间切换，开销小很多。
* 系统阻塞时，当前进程会被阻塞。可以使用同步非阻塞IO和IO多路复用技术解决，但是实现复杂。对于内存缺页等场景进程仍会被阻塞，尽管其它进程可能仍可以运行。
* 在一个进程内部，没有时钟中断，所以不可能用轮转调度方式调度用户级线程。此时，用户级线程运行是非抢占式的。可以考虑让运行时系统请求每秒一次的时钟信号（中断）来实现，但是开销会很大。
* 用户级线程并不能够充分利用多处理机的并行能力。

将内核级线程与用户级线程混合使用，可以将两者的优点结合起来。一些应用框架或者程序设计语言就采用了类似的思路，比如，Golang就原生支持了这样的方式。

## 6. 参考 ##

《现代操作系统》，Tanenbaum，P60，用户态和内核态线程。
